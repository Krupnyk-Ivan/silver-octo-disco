<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TacticalMed - Student UI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="bg-light">
    <div class="container py-4">
      <div class="row mb-4">
        <div class="col">
          <h1 class="h3">TacticalMed — Student UI</h1>
          <p class="text-muted">Submit answers and view review results (mock AI scoring).</p>
        </div>
      </div>

      <div class="row">
        <div class="col-md-7">
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title">Submit Answer</h5>
              <form id="submitForm">
                <div class="mb-2">
                  <label class="form-label">Student ID</label>
                  <input class="form-control" name="studentId" id="studentId" value="student1" required />
                </div>
                <div class="mb-2">
                  <label class="form-label">Question</label>
                  <input class="form-control" name="question" id="question" value="What is the first step for massive hemorrhage?" required />
                </div>
                <div class="mb-3">
                  <label class="form-label">Answer</label>
                  <textarea class="form-control" name="answerText" id="answerText" rows="4">Apply a tourniquet and direct pressure</textarea>
                </div>
                <button class="btn btn-primary" type="submit">Submit</button>
                <span id="submitStatus" class="ms-3"></span>
              </form>
            </div>
          </div>

          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Lookup Submission</h5>
              <div class="input-group">
                <input id="lookupId" class="form-control" placeholder="Submission id (GUID)" />
                <button id="lookupBtn" class="btn btn-outline-secondary">Lookup</button>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-5">
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title">Result</h5>
              <pre id="resultArea" style="white-space:pre-wrap;word-break:break-word;">No results yet.</pre>
            </div>
          </div>

          <div class="card">
            <div class="card-body">
              <h5 class="card-title">AI Review</h5>
              <div id="aiReview">
                <div><strong>Status:</strong> <span id="aiStatus">-</span></div>
                <div><strong>Score:</strong> <span id="aiScore">-</span></div>
                <div class="mt-2"><strong>Feedback:</strong>
                  <div id="aiFeedback" style="white-space:pre-wrap;word-break:break-word;">-</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <footer class="mt-4 text-muted">Gateway: {{ gateway }} — RabbitMQ-backed review flow</footer>
    </div>

    <script>
      const apiBase = '';

      async function postJson(path, body) {
        const resp = await fetch(path, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
          body: JSON.stringify(body)
        });
        return resp;
      }

      document.getElementById('submitForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const payload = {
          StudentId: document.getElementById('studentId').value,
          Question: document.getElementById('question').value,
          AnswerText: document.getElementById('answerText').value
        };
        const statusEl = document.getElementById('submitStatus');
        statusEl.textContent = 'Submitting...';
        try {
          const r = await postJson('/api/submit', payload);
          const data = await r.json();
          statusEl.textContent = r.ok ? 'Submitted' : 'Error';
          document.getElementById('resultArea').textContent = JSON.stringify(data, null, 2);
          if (data && data.id) {
            document.getElementById('lookupId').value = data.id;
          }
          // clear any previous AI review
          document.getElementById('aiStatus').textContent = '-';
          document.getElementById('aiScore').textContent = '-';
        } catch (err) {
          statusEl.textContent = 'Network error';
          document.getElementById('resultArea').textContent = String(err);
        }
      });

      document.getElementById('lookupBtn').addEventListener('click', async () => {
        const id = document.getElementById('lookupId').value.trim();
        if (!id) return;
        document.getElementById('resultArea').textContent = 'Looking up...';
        try {
          const r = await fetch(`/api/get/${encodeURIComponent(id)}`);
            if (r.status === 200) {
            const data = await r.json();
            document.getElementById('resultArea').textContent = JSON.stringify(data, null, 2);
            // Show AI review fields if present
            document.getElementById('aiStatus').textContent = data.status || '-';
            document.getElementById('aiScore').textContent = (data.score !== undefined && data.score !== null) ? String(data.score) : '-';
            document.getElementById('aiFeedback').textContent = data.feedback || data.feedbackText || data.Feedback || '-';
          } else {
            const text = await r.text();
            document.getElementById('resultArea').textContent = text;
            document.getElementById('aiStatus').textContent = '-';
            document.getElementById('aiScore').textContent = '-';
            document.getElementById('aiFeedback').textContent = '-';
          }
        } catch (err) {
          document.getElementById('resultArea').textContent = String(err);
          document.getElementById('aiStatus').textContent = '-';
          document.getElementById('aiScore').textContent = '-';
        }
      });
    </script>

  </body>
</html>
